<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sneaker Store Analytics - Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .kpi-card { text-align: center; }
        .kpi-value { font-size: 2em; font-weight: bold; color: #2563eb; }
        .kpi-label { color: #666; margin-top: 5px; }
        .product-list { list-style: none; padding: 0; }
        .product-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .error { background: #fee; color: #c53030; padding: 15px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Elite Sneaker Store Analytics</h1>
        <p>Real-time dashboard showing your sneaker and streetwear business performance</p>
        
        <div id="loading" class="loading">Loading analytics data...</div>
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="dashboard" style="display: none;">
            <div class="card">
                <h2>üìä Key Performance Indicators</h2>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-value" id="total-revenue">$0</div>
                        <div class="kpi-label">üí∞ Total Revenue</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="avg-order">$0</div>
                        <div class="kpi-label">üõí Avg Order Value</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="repeat-customers">0</div>
                        <div class="kpi-label">üë• Repeat Customers</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="profit-margin">0%</div>
                        <div class="kpi-label">üìà Profit Margin</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>üèÜ Top Selling Products</h2>
                <ul id="top-products" class="product-list"></ul>
            </div>
        </div>
    </div>

    <script>
        async function loadDashboard() {
            try {
                const response = await fetch('http://127.0.0.1:8000/api/v1/dashboard/kpis?days=30');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                console.log('Dashboard data:', data);
                
                // Calculate total revenue from top products
                const totalRevenue = data.top_products.reduce((sum, product) => sum + product.total_revenue, 0);
                
                // Update KPIs
                document.getElementById('total-revenue').textContent = `$${totalRevenue.toLocaleString()}`;
                document.getElementById('avg-order').textContent = `$${data.avg_order_value?.toLocaleString() || '0'}`;
                document.getElementById('repeat-customers').textContent = data.repeat_customers || '0';
                document.getElementById('profit-margin').textContent = `${data.profit_margin?.toFixed(1) || '0'}%`;
                
                // Update top products
                const productsList = document.getElementById('top-products');
                productsList.innerHTML = '';
                
                data.top_products.forEach((product, index) => {
                    const li = document.createElement('li');
                    li.className = 'product-item';
                    li.innerHTML = `
                        <span><strong>#${index + 1}</strong> ${product.product_name}</span>
                        <span><strong>$${product.total_revenue.toLocaleString()}</strong> (${product.total_sales} sales)</span>
                    `;
                    productsList.appendChild(li);
                });
                
                // Show dashboard
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = `Error: ${error.message}`;
            }
        }
        
        // Load dashboard on page load
        loadDashboard();
        
        // Refresh every 30 seconds
        setInterval(loadDashboard, 30000);
    </script>
</body>
</html>